# JWT Authentication Architecture

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚
â”‚     Client      â”‚
â”‚  (Web/Mobile)   â”‚
â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. Login Request
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Authentication Service    â”‚
â”‚   (http://localhost:3020)   â”‚
â”‚                             â”‚
â”‚  POST /api/auth/login       â”‚
â”‚  - Validates credentials    â”‚
â”‚  - Generates JWT            â”‚
â”‚  - Signs with private key   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 2. Returns JWT Token
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Client      â”‚
â”‚  Stores Token   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 3. API Request
         â”‚    Authorization: Bearer <JWT>
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         FD Module Application           â”‚
â”‚       (http://localhost:8080)           â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚       Security Filter Chain       â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  1. Extract JWT from Header      â”‚ â”‚
â”‚  â”‚  2. Fetch Public Key (once)      â”‚ â—„â”€â”
â”‚  â”‚  3. Validate JWT Signature       â”‚ â”‚ â”‚
â”‚  â”‚  4. Check Expiration             â”‚ â”‚ â”‚
â”‚  â”‚  5. Extract User Claims          â”‚ â”‚ â”‚
â”‚  â”‚  6. Set Security Context         â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚              â”‚                          â”‚ â”‚
â”‚              â–¼                          â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚         Controllers               â”‚ â”‚ â”‚
â”‚  â”‚  /api/v1/accounts                â”‚ â”‚ â”‚
â”‚  â”‚  /api/v1/reports                 â”‚ â”‚ â”‚
â”‚  â”‚  /api/v1/jobs                    â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚              â”‚                          â”‚ â”‚
â”‚              â–¼                          â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚         Services                  â”‚ â”‚ â”‚
â”‚  â”‚  - JwtUtils.getCurrentUserId()   â”‚ â”‚ â”‚
â”‚  â”‚  - Access JWT claims             â”‚ â”‚ â”‚
â”‚  â”‚  - Business logic                â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                            â”‚
                                            â”‚ 4. GET /api/auth/public-key
                                            â”‚    (On startup)
                                            â”‚
                                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”
â”‚         Authentication Service                â”‚
â”‚       (http://localhost:3020)                 â”‚
â”‚                                               â”‚
â”‚  GET /api/auth/public-key                    â”‚
â”‚  Returns:                                     â”‚
â”‚  {                                            â”‚
â”‚    "keys": [{                                 â”‚
â”‚      "kty": "RSA",                            â”‚
â”‚      "e": "AQAB",                             â”‚
â”‚      "n": "AM4VMDVb9jk9giR..."                â”‚
â”‚    }]                                         â”‚
â”‚  }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Request Flow

### 1. Authentication Flow
```
Client                    Auth Service              FD Module
  â”‚                            â”‚                        â”‚
  â”‚â”€â”€â”€ POST /login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
  â”‚    (credentials)           â”‚                        â”‚
  â”‚                            â”‚                        â”‚
  â”‚<â”€â”€ JWT Token â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
  â”‚                            â”‚                        â”‚
```

### 2. API Request Flow
```
Client                    FD Module                Auth Service
  â”‚                          â”‚                          â”‚
  â”‚â”€â”€â”€ GET /api/v1/... â”€â”€â”€â”€â”€>â”‚                          â”‚
  â”‚    Authorization:        â”‚                          â”‚
  â”‚    Bearer <JWT>          â”‚                          â”‚
  â”‚                          â”‚                          â”‚
  â”‚                          â”‚â”€â”€ Get Public Key â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                          â”‚   (First request only)   â”‚
  â”‚                          â”‚                          â”‚
  â”‚                          â”‚<â”€â”€ RSA Public Key â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                          â”‚                          â”‚
  â”‚                          â”‚                          â”‚
  â”‚                          â”‚ Validate JWT             â”‚
  â”‚                          â”‚ - Verify signature       â”‚
  â”‚                          â”‚ - Check expiration       â”‚
  â”‚                          â”‚ - Extract claims         â”‚
  â”‚                          â”‚                          â”‚
  â”‚<â”€â”€ Response â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚
  â”‚    (Data or 401)         â”‚                          â”‚
```

## Component Interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Spring Security Filter Chain            â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  1. JwtAuthenticationFilter                â”‚    â”‚
â”‚  â”‚     - Extracts "Bearer <token>" from       â”‚    â”‚
â”‚  â”‚       Authorization header                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                 â”‚                                    â”‚
â”‚                 â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  2. JwtDecoder                             â”‚    â”‚
â”‚  â”‚     - Uses RSA Public Key                  â”‚    â”‚
â”‚  â”‚     - Validates signature                  â”‚    â”‚
â”‚  â”‚     - Parses claims                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                 â”‚                                    â”‚
â”‚                 â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  3. JwtAuthenticationConverter             â”‚    â”‚
â”‚  â”‚     - Extracts "roles" claim               â”‚    â”‚
â”‚  â”‚     - Converts to GrantedAuthorities       â”‚    â”‚
â”‚  â”‚     - Creates Authentication object        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                 â”‚                                    â”‚
â”‚                 â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  4. SecurityContextHolder                  â”‚    â”‚
â”‚  â”‚     - Stores Authentication                â”‚    â”‚
â”‚  â”‚     - Available to all components          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Your Controllers    â”‚
            â”‚   - Can access JWT    â”‚
            â”‚   - Can get user info â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## JWT Token Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JWT Token                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Header (Algorithm & Type)                          â”‚
â”‚  {                                                   â”‚
â”‚    "alg": "RS256",                                   â”‚
â”‚    "typ": "JWT"                                      â”‚
â”‚  }                                                   â”‚
â”‚                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Payload (Claims)                                    â”‚
â”‚  {                                                   â”‚
â”‚    "sub": "user123",           // User ID           â”‚
â”‚    "name": "John Doe",         // User name         â”‚
â”‚    "email": "john@example.com",// Email             â”‚
â”‚    "roles": ["CUSTOMER"],      // User roles        â”‚
â”‚    "exp": 1729699200,          // Expiration        â”‚
â”‚    "iat": 1729695600           // Issued at         â”‚
â”‚  }                                                   â”‚
â”‚                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Signature (Verified with Public Key)               â”‚
â”‚  RSASHA256(                                          â”‚
â”‚    base64UrlEncode(header) + "." +                  â”‚
â”‚    base64UrlEncode(payload),                        â”‚
â”‚    private_key  // Signed by auth service           â”‚
â”‚  )                                                   â”‚
â”‚  // Verified with public_key in FD Module           â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Public Key Fetching Process

```
On Application Startup:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FD Module Startup                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  1. Load Configuration                              â”‚
â”‚     - Read auth.service.base-url                    â”‚
â”‚     - Read auth.service.public-key-path             â”‚
â”‚                                                      â”‚
â”‚  2. JwtPublicKeyProvider.fetchPublicKey()           â”‚
â”‚     â”‚                                                â”‚
â”‚     â”œâ”€> HTTP GET to:                                â”‚
â”‚     â”‚   http://localhost:3020/api/auth/public-key   â”‚
â”‚     â”‚                                                â”‚
â”‚     â”œâ”€> Parse JSON response:                        â”‚
â”‚     â”‚   {                                            â”‚
â”‚     â”‚     "keys": [{                                 â”‚
â”‚     â”‚       "n": "AM4VMDVb...",  // Modulus          â”‚
â”‚     â”‚       "e": "AQAB"          // Exponent         â”‚
â”‚     â”‚     }]                                         â”‚
â”‚     â”‚   }                                            â”‚
â”‚     â”‚                                                â”‚
â”‚     â”œâ”€> Decode Base64 URL values                    â”‚
â”‚     â”‚                                                â”‚
â”‚     â”œâ”€> Create RSAPublicKeySpec                     â”‚
â”‚     â”‚                                                â”‚
â”‚     â””â”€> Return RSAPublicKey                         â”‚
â”‚                                                      â”‚
â”‚  3. Configure JwtDecoder with public key            â”‚
â”‚                                                      â”‚
â”‚  4. Ready to validate JWTs!                         â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Endpoints Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SecurityConfig - Endpoint Protection Rules         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  PUBLIC (No Authentication Required)                â”‚
â”‚  âœ“ /swagger-ui/**                                   â”‚
â”‚  âœ“ /api-docs/**                                     â”‚
â”‚  âœ“ /v3/api-docs/**                                  â”‚
â”‚  âœ“ /actuator/**                                     â”‚
â”‚                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  PROTECTED (JWT Required)                           â”‚
â”‚  ğŸ”’ /api/v1/accounts/**                             â”‚
â”‚  ğŸ”’ /api/v1/reports/**                              â”‚
â”‚  ğŸ”’ /api/v1/jobs/**                                 â”‚
â”‚  ğŸ”’ /api/v1/auth/**                                 â”‚
â”‚  ğŸ”’ All other requests                              â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow in Controllers

```
HTTP Request
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SecurityFilterChain                â”‚
â”‚  - Validates JWT                    â”‚
â”‚  - Sets SecurityContext             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Controller Method                  â”‚
â”‚                                     â”‚
â”‚  @GetMapping("/api/v1/example")    â”‚
â”‚  public ResponseEntity<?> method(  â”‚
â”‚    @AuthenticationPrincipal Jwt jwtâ”‚ â—„â”€â”€ JWT injected here
â”‚  ) {                                â”‚
â”‚                                     â”‚
â”‚    String userId = jwt.getSubject();â”‚
â”‚    String email = jwt.getClaim(...);â”‚
â”‚                                     â”‚
â”‚    return service.getData(userId); â”‚
â”‚  }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service Layer                      â”‚
â”‚                                     â”‚
â”‚  public Data getData(String userId){â”‚
â”‚    // Can also use:                â”‚
â”‚    String userId =                 â”‚
â”‚      JwtUtils.getCurrentUserId(); â”‚
â”‚                                     â”‚
â”‚    return repository.find(userId); â”‚
â”‚  }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Flow

```
Request without JWT
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SecurityFilterChain                â”‚
â”‚  - No Authorization header          â”‚
â”‚  - Or invalid JWT                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Return 401 Unauthorized            â”‚
â”‚                                     â”‚
â”‚  {                                  â”‚
â”‚    "timestamp": "...",              â”‚
â”‚    "status": 401,                   â”‚
â”‚    "error": "Unauthorized",         â”‚
â”‚    "message": "Full auth required", â”‚
â”‚    "path": "/api/v1/..."            â”‚
â”‚  }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Summary

This architecture provides:
- âœ… **Stateless authentication** - No sessions
- âœ… **Secure** - RSA signature validation
- âœ… **Scalable** - Each instance validates independently
- âœ… **Flexible** - Easy to change auth service
- âœ… **Standard** - OAuth2/JWT industry standards
